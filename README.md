## Persian Sentiment Analyzer (Streamlit)

وب‌اپلیکیشن «تحلیل احساسات فارسی» یک داشبورد تحت وب با Streamlit است که از مدل `HooshvareLab/bert-fa-base-uncased-sentiment-snappfood` برای تحلیل احساسات متون فارسی استفاده می‌کند. این برنامه برای محیط تولید (production) طراحی شده و شامل حالت‌های مختلف تحلیل، تاریخچه جلسه، مصورسازی‌های تعاملی و زیرساخت CI/CD است.

### ویژگی‌ها

- **تحلیل تکی متن**: تحلیل لحظه‌ای احساس (مثبت / منفی / خنثی) با نمایش:
  - **برچسب نهایی احساس**
  - **درصد اعتماد مدل (confidence)**
  - **نمودار گیج / قطبی با Plotly**
  - **نمودار میله‌ای توزیع احساسات**
- **تحلیل دسته‌ای CSV**:
  - بارگذاری فایل CSV با ستون متنی (پیش‌فرض `review`)
  - پردازش دسته‌ای با نوار پیشرفت (Progress bar)
  - نمودار **کیکی** و **میله‌ای** توزیع برچسب‌ها
  - دانلود خروجی با برچسب احساس به صورت CSV
- **مقایسه متنی**:
  - مقایسه هم‌زمان دو متن در کنار هم
  - نمایش برچسب، اعتماد و نمودار اعتماد جداگانه برای هر متن
- **پشتیبانی کامل از فارسی و RTL**:
  - راست‌به‌چپ برای متن‌ها
  - فونت فارسی و استایل سفارشی
  - گرادیان رنگی مدرن برای پس‌زمینه و تیترها
- **تاریخچه جلسه (Session History)**:
  - ذخیره ۲۰ تحلیل آخر در جلسه جاری
  - نمایش برچسب، اعتماد و متن اصلی
- **اطلاعات مدل و عملکرد**:
  - مدل: `HooshvareLab/bert-fa-base-uncased-sentiment-snappfood`
  - **دقت گزارش‌شده**: 94.5%
  - **هدف تاخیر**: کمتر از 100 میلی‌ثانیه برای هر پردازش (نمایش آمار متوسط و بیشینه تاخیر در سایدبار)
- **کد تولیدی با کیفیت بالا**:
  - استفاده از **type hints**، **docstring** و تفکیک لایه‌ها (app، models، utils، components)
  - تست‌های اولیه با **pytest**
  - Dockerfile و GitHub Actions برای CI

### ساختار پروژه

```text
Sentiment Analyzer/
├─ app/
│  ├─ main.py               # داشبورد Streamlit (نقطه ورود)
│  ├─ components.py         # کامپوننت‌های UI، نمودارها، CSS
│  └─ utils.py              # ابزارهای کمکی، بارگذاری تنظیمات، آمار تاخیر
├─ models/
│  └─ sentiment_model.py    # کلاس SentimentAnalyzer و منطق مدل
├─ data/
│  └─ sample_reviews.csv    # 20 نمونه نظر فارسی با برچسب
├─ tests/
│  └─ test_app.py           # تست‌های اولیه با pytest
├─ config.yaml              # تنظیمات برنامه، مدل و UI
├─ requirements.txt         # وابستگی‌های پایتونی
├─ Dockerfile               # ایمیج داکر برای استقرار
├─ .github/workflows/ci.yml # گردش‌کار GitHub Actions برای اجرای تست‌ها
├─ .gitignore
├─ LICENSE                  # مجوز MIT
└─ README.md
```

### نصب و راه‌اندازی (لوکال)

1. **کلون کردن یا کپی پروژه**

2. **ایجاد و فعال‌سازی محیط مجازی (اختیاری ولی توصیه‌شده)**

```bash
python -m venv .venv
.venv\\Scripts\\activate  # در ویندوز
```

3. **نصب وابستگی‌ها**

```bash
pip install --upgrade pip
pip install -r requirements.txt
```

4. **اجرای برنامه Streamlit**

```bash
streamlit run app/main.py
```

سپس در مرورگر خود به آدرس `http://localhost:8501` بروید.

### پیکربندی

فایل `config.yaml` شامل تنظیمات اصلی است:

- **app**:
  - `title`: عنوان صفحه
  - `description`: توضیح کوتاه برنامه
  - `max_text_length`: حداکثر طول ورودی برای مدل BERT
  - `batch_chunk_size`: اندازه بچ برای پردازش دسته‌ای
- **model**:
  - `name`: نام مدل در Hugging Face
  - `accuracy`: دقت گزارش‌شده (در UI نمایش داده می‌شود)
  - `max_latency_ms`: هدف حداکثر تاخیر
- **ui**:
  - تنظیم رنگ‌ها و گرادیان‌ها

در صورت نیاز می‌توانید مقادیر را متناسب با نیاز خود تغییر دهید.

### مدل و منطق احساس

فایل `models/sentiment_model.py` شامل کلاس `SentimentAnalyzer` است که:

- مدل `HooshvareLab/bert-fa-base-uncased-sentiment-snappfood` را بارگذاری می‌کند.
- با استفاده از **TextClassificationPipeline** از کتابخانه `transformers`، احتمال هر برچسب را محاسبه می‌کند.
- این مدل ذاتاً **دو برچسب** دارد (مثبت/منفی). برای برآورده کردن نیاز سه‌کلاسه:
  - اگر احتمال مثبت از آستانه `positive_threshold` بالاتر باشد، برچسب **مثبت** برمی‌گرداند.
  - اگر احتمال منفی از آستانه `negative_threshold` بالاتر باشد، برچسب **منفی** برمی‌گرداند.
  - در غیر این صورت برچسب **خنثی** برمی‌گرداند.
- برای هر پیش‌بینی:
  - برچسب نهایی (`مثبت`، `منفی`، `خنثی`)
  - میزان اعتماد (score)
  - زمان تاخیر (latency_ms) را برمی‌گرداند.

### حالت‌های تحلیل در UI

- **تحلیل تکی متن**:
  - ورودی یک متن فارسی
  - نمایش نتیجه، اعتماد، تاخیر و نمودار گیج
  - اضافه شدن هر نتیجه به تاریخچه جلسه

- **تحلیل فایل CSV**:
  - بارگذاری فایل CSV با ستون متنی
  - پردازش به صورت بچ‌ها (با اندازه `batch_chunk_size`)
  - نمایش نوار پیشرفت
  - اضافه شدن نتایج به تاریخچه
  - نمایش نمودار کیکی و میله‌ای توزیع احساس
  - امکان دانلود فایل نتایج

- **مقایسه متنی**:
  - دو متن مجزا
  - تحلیل جداگانه برای هر متن
  - نمایش برچسب و اعتماد و نمودار برای هرکدام در دو ستون

### داده نمونه

فایل `data/sample_reviews.csv` شامل 20 نمونه نظر فارسی با برچسب‌های `مثبت`، `منفی` و `خنثی` است که می‌توانید برای آزمایش سریع حالت دسته‌ای یا آموزش کاربران استفاده کنید.

### اجرای تست‌ها

برای اجرای تست‌های واحد:

```bash
pytest
```

فایل `tests/test_app.py` چند تست ساده برای:

- بارگذاری تنظیمات
- مقدار دقت گزارش‌شده
- مقداردهی اولیه `SentimentAnalyzer`

را فراهم می‌کند.

### اجرای در Docker

برای ساخت ایمیج و اجرای برنامه با Docker:

```bash
docker build -t persian-sentiment-analyzer .
docker run -p 8501:8501 persian-sentiment-analyzer
```

سپس به `http://localhost:8501` مراجعه کنید.

### CI/CD با GitHub Actions

فایل `.github/workflows/ci.yml` یک گردش‌کار ساده CI را تعریف می‌کند که:

- روی هر `push` و `pull_request` به `main`/`master` اجرا می‌شود.
- وابستگی‌ها را نصب کرده و تست‌ها را با `pytest` اجرا می‌کند.

می‌توانید این گردش‌کار را برای استقرار خودکار (CD) گسترش دهید.

### نکات تولیدی (Production-Ready)

- استفاده از **type hints** و **docstring** برای خوانایی و نگه‌داری بهتر.
- مدیریت خطا:
  - بررسی خالی بودن متن ورودی
  - مدیریت خطا در خواندن CSV
  - مدیریت خطا در بارگذاری مدل و تنظیمات
- جداسازی مسئولیت‌ها:
  - `app/main.py`: منطق UI و جریان صفحه
  - `app/components.py`: کامپوننت‌های UI و نمودارها
  - `app/utils.py`: ابزارهای کمکی و آمار عملکرد
  - `models/sentiment_model.py`: منطق مدل و پیش‌پردازش/پس‌پردازش

### مجوز

این پروژه تحت مجوز **MIT** منتشر شده است. جزئیات کامل در فایل `LICENSE` موجود است.

